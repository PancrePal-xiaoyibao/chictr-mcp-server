# ChiCTR MCP Server 开发任务列表

## 阶段 1: 项目初始化
- [x] 1.1 创建项目目录结构
- [x] 1.2 初始化 package.json 和 tsconfig.json
- [x] 1.3 安装依赖包
  - @modelcontextprotocol/sdk
  - playwright
  - cheerio (HTML 解析)
  - typescript, @types/node

## 阶段 2: MCP Server 基础框架
- [x] 2.1 创建 MCP Server 入口文件 (src/index.ts)
- [x] 2.2 配置 Server 元数据（名称、版本）
- [x] 2.3 定义 Tools Schema
  - search_trials 工具定义
  - get_trial_detail 工具定义

## 阶段 3: 浏览器自动化核心
- [x] 3.1 创建 Playwright 浏览器管理器 (src/browser.ts)
  - 浏览器初始化
  - 页面管理
  - 资源清理
- [x] 3.2 实现反爬虫处理
  - 设置 User-Agent
  - 随机延迟
  - Cookie 管理

## 阶段 4: 搜索功能实现
- [x] 4.1 创建搜索服务 (src/services/search.ts)
- [x] 4.2 实现 URL 构建（关键词 + 时间范围）
- [x] 4.3 页面导航和等待加载
- [x] 4.4 HTML 解析 - 提取列表数据
  - 注册号
  - 注册题目
  - 研究类型
  - 注册时间
  - 研究实施单位
- [x] 4.5 实现时间过滤（过去 N 个月）
- [x] 4.6 实现结果排序（最近到最远）
- [x] 4.7 限制结果数量

## 阶段 5: 详情查询功能实现
- [x] 5.1 创建详情服务 (src/services/detail.ts)
- [x] 5.2 构建详情页 URL
- [x] 5.3 页面导航和加载
- [x] 5.4 HTML 解析 - 提取详细字段
  - 基本信息区块
  - 联系信息区块
  - 伦理信息区块
  - 研究信息区块
  - 干预措施区块
  - 纳入排除标准区块
- [x] 5.5 数据格式化为 JSON

## 阶段 6: 数据解析器
- [x] 6.1 创建 HTML 解析工具 (src/parsers/html-parser.ts)
- [x] 6.2 实现列表页解析器
- [x] 6.3 实现详情页解析器
- [x] 6.4 处理中英文字段提取
- [x] 6.5 数据清洗和格式化

## 阶段 7: 错误处理和日志
- [x] 7.1 实现错误处理机制
  - 网络错误
  - 解析错误
  - 超时处理
- [x] 7.2 添加日志输出
- [x] 7.3 实现重试机制

## 阶段 8: 工具函数整合
- [x] 8.1 整合 search_trials 工具处理函数
- [x] 8.2 整合 get_trial_detail 工具处理函数
- [x] 8.3 参数验证
- [x] 8.4 响应格式标准化

## 阶段 9: 测试
- [x] 9.1 手动测试搜索功能
  - 测试关键词: "KRAS G12C"
  - 测试时间范围筛选
  - 验证结果排序
- [x] 9.2 手动测试详情查询
  - 使用真实注册号测试
  - 验证所有字段提取正确
- [x] 9.3 测试边界情况
  - 无结果情况
  - 无效注册号
  - 网络异常
- [x] 9.4 缓存功能测试
  - 缓存命中验证
  - 缓存统计信息
  - 缓存清除功能
- [x] 9.5 MCP 功能完整性验证
  - 依赖包检查
  - 源代码完整性
  - 核心功能验证
- [x] 9.6 KRAS G12D 查询演示
  - 搜索功能测试
  - 详情查询测试
  - 缓存机制验证
  - 真实数据展示

## 阶段 10: 构建和配置
- [x] 10.1 配置 TypeScript 编译
- [x] 10.2 添加构建脚本
- [x] 10.3 配置 MCP Server 启动脚本
- [x] 10.4 创建 .gitignore
- [x] 10.5 依赖包安装和项目构建

## 阶段 11: 性能优化
- [x] 11.1 添加缓存机制
  - 搜索结果缓存（5分钟）
  - 详情数据缓存（10分钟）
- [x] 11.2 缓存管理工具
  - 查看缓存统计信息
  - 清除缓存数据

## 阶段 12: 文档（仅在用户明确要求时）
- [x] 12.1 创建 README.md（中文版）
- [x] 12.2 创建 README_EN.md（英文版）
- [x] 12.3 添加使用示例
- [x] 12.4 添加配置说明

## 阶段 13: 发布准备
- [x] 13.1 推送到 GitHub
- [x] 13.2 发布到 NPM
- [x] 13.3 验证 npx 可用性

---

## 当前优先级
**P0（高优先级）**: 阶段 1-8
**P1（中优先级）**: 阶段 9-10
**P2（低优先级）**: 阶段 11-12（仅在明确要求时执行）
